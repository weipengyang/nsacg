<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>积分收益</title>
    <meta name="viewport" content="width=device-width,height=device-height,inital-scale=1.0,maximum-scale=1.0,user-scalable=no;">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
   
    <link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm-extend.min.css">
    <link rel="stylesheet" href="https://res.wx.qq.com/open/libs/weui/0.4.1/weui.min.css" />
    <link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm.min.css">
    <link href="//at.alicdn.com/t/font_1473075050_6251314.css" rel="stylesheet" type="text/css" />

    <style>
        .pic {
            width: 100%;
            margin-bottom: 10px;
        }
         .logo {
            display: block;
            width: 2.5rem;
            height: 2.5rem;
            color: white;
            text-align: center;
            line-height: 2rem;
            margin: 2px;
            border-radius: 100%;
        }

        .line {
            width: 100%;
            height: 2.5rem;
            line-height: 2.5rem;
            overflow: hidden;
            margin: 0px;
            text-align: center;
            padding: 0px;
            color: #FF6600;
            font-size: 1.4rem;
            background: #333333;
            z-index: 9999;
            font-weight: bold;
            filter: alpha(opacity=40);
            -moz-opacity: 0.4;
            -khtml-opacity: 0.4;
            opacity: 0.4;
        }
        .bg {
            margin-top: 0.5rem;
            padding:0;
            color: white;
            background: #fcecfc; /* Old browsers */
            background: -moz-linear-gradient(left, #fcecfc 0%, #fd89d7 33%, #fba6e1 53%, #fd89d7 61%, #ff7cd8 100%); /* FF3.6+ */
            background: -webkit-gradient(linear, left top, right top, color-stop(0%,#fcecfc), color-stop(33%,#fd89d7), color-stop(53%,#fba6e1), color-stop(61%,#fd89d7), color-stop(100%,#ff7cd8)); /* Chrome,Safari4+ */
            background: -webkit-linear-gradient(top,#FF6600 0%,#FF4900 100%); /* Chrome10+,Safari5.1+ */
            background: -o-linear-gradient(top, #FF6600 0%,#FF6600 33%,#FF6600 53%,#FF6600 61%,#FF6600 100%); /* Opera11.10+ */
            filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#fcecfc', endColorstr='#ff7cd8',GradientType=1 ); /* IE6-9 */
            background: linear-gradient(left, #fcecfc 0%,#fd89d7 33%,#fba6e1 53%,#fd89d7 61%,#ff7cd8 100%); /* W3C */ 
            filter: alpha(opacity=50);
            opacity: 0.8;
        }
   </style>
</head>
<body>
    <div class="page" style="margin:0px">
        <header class="bar bar-nav">
            <a class="button button-link button-nav pull-left" href="#" onclick="history.go(-1);" data-transition='slide-out'>
                <span class="icon icon-left"></span>
                返回
            </a>
        </header>
        <div class="content" style="margin:0px">
            <div class="card bg" style="margin:0px;padding:0px">
                <div class="card-content">
                    <div class="item-title" style="margin:0px;padding:0px">
                        <div class="row">
                            <div class="col-100" >
                                <a href="/index.php?g=Wap&m=Store&a=helpscore" external>
                                    <i class="icon iconfont icon-jieda" style='color:white;font-size:1rem;position:absolute;right:10px'></i>
                                </a>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-100" style="text-align:center;font-size:1rem">累计收益(分)</div>
                            <div class="col-100" style="text-align:center;font-size:1.5rem">{pigcms:$sumscore}</div>
                        </div>  
                        <div class="row">
                            <div class="col-50" style="text-align:center;font-size:0.8rem">余额:{pigcms:$balance}元</div>
                            <div class="col-50" style="text-align:center;font-size:0.8rem">每{pigcms:$profitunit}元收益1积分</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="infinite-scroll infinite-scroll-bottom" data-distance="100">
                <div class="list-block" style="margin:0px;padding:0px">
                    <ul class="list-container"></ul>
                </div>
                <!-- 加载提示符 -->
                <div class="infinite-scroll-preloader">
                   <span>点击加载更多</span>
                </div>
            </div>
        </div>
        </div>
    <script type='text/javascript' src='//g.alicdn.com/sj/lib/zepto/zepto.min.js' charset='utf-8'></script>
    <script type='text/javascript' src='//g.alicdn.com/msui/sm/0.6.2/js/sm.min.js' charset='utf-8'></script>
    <script type="text/javascript">
        /** 
         * 和PHP一样的时间戳格式化函数 
         * @param {string} format 格式 
         * @param {int} timestamp 要格式化的时间 默认为当前时间 
         * @return {string}   格式化的时间字符串 
         */
        function date(format, timestamp){ 
            var a, jsdate=((timestamp) ? new Date(timestamp*1000) : new Date()); 
            var pad = function(n, c){ 
                if((n = n + "").length < c){ 
                    return new Array(++c - n.length).join("0") + n; 
                } else { 
                    return n; 
                } 
            }; 
            var txt_weekdays = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]; 
            var txt_ordin = {1:"st", 2:"nd", 3:"rd", 21:"st", 22:"nd", 23:"rd", 31:"st"}; 
            var txt_months = ["", "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]; 
            var f = { 
                // Day 
                d: function(){return pad(f.j(), 2)}, 
                D: function(){return f.l().substr(0,3)}, 
                j: function(){return jsdate.getDate()}, 
                l: function(){return txt_weekdays[f.w()]}, 
                N: function(){return f.w() + 1}, 
                S: function(){return txt_ordin[f.j()] ? txt_ordin[f.j()] : 'th'}, 
                w: function(){return jsdate.getDay()}, 
                z: function(){return (jsdate - new Date(jsdate.getFullYear() + "/1/1")) / 864e5 >> 0}, 
   
                // Week 
                W: function(){ 
                    var a = f.z(), b = 364 + f.L() - a; 
                    var nd2, nd = (new Date(jsdate.getFullYear() + "/1/1").getDay() || 7) - 1; 
                    if(b <= 2 && ((jsdate.getDay() || 7) - 1) <= 2 - b){ 
                        return 1; 
                    } else{ 
                        if(a <= 2 && nd >= 4 && a >= (6 - nd)){ 
                            nd2 = new Date(jsdate.getFullYear() - 1 + "/12/31"); 
                            return date("W", Math.round(nd2.getTime()/1000)); 
                        } else{ 
                            return (1 + (nd <= 3 ? ((a + nd) / 7) : (a - (7 - nd)) / 7) >> 0); 
                        } 
                    } 
                }, 
   
                // Month 
                F: function(){return txt_months[f.n()]}, 
                m: function(){return pad(f.n(), 2)}, 
                M: function(){return f.F().substr(0,3)}, 
                n: function(){return jsdate.getMonth() + 1}, 
                t: function(){ 
                    var n; 
                    if( (n = jsdate.getMonth() + 1) == 2 ){ 
                        return 28 + f.L(); 
                    } else{ 
                        if( n & 1 && n < 8 || !(n & 1) && n > 7 ){ 
                            return 31; 
                        } else{ 
                            return 30; 
                        } 
                    } 
                }, 
   
                // Year 
                L: function(){var y = f.Y();return (!(y & 3) && (y % 1e2 || !(y % 4e2))) ? 1 : 0}, 
                //o not supported yet 
                Y: function(){return jsdate.getFullYear()}, 
                y: function(){return (jsdate.getFullYear() + "").slice(2)}, 
   
                // Time 
                a: function(){return jsdate.getHours() > 11 ? "pm" : "am"}, 
                A: function(){return f.a().toUpperCase()}, 
                B: function(){ 
                    // peter paul koch: 
                    var off = (jsdate.getTimezoneOffset() + 60)*60; 
                    var theSeconds = (jsdate.getHours() * 3600) + (jsdate.getMinutes() * 60) + jsdate.getSeconds() + off; 
                    var beat = Math.floor(theSeconds/86.4); 
                    if (beat > 1000) beat -= 1000; 
                    if (beat < 0) beat += 1000; 
                    if ((String(beat)).length == 1) beat = "00"+beat; 
                    if ((String(beat)).length == 2) beat = "0"+beat; 
                    return beat; 
                }, 
                g: function(){return jsdate.getHours() % 12 || 12}, 
                G: function(){return jsdate.getHours()}, 
                h: function(){return pad(f.g(), 2)}, 
                H: function(){return pad(jsdate.getHours(), 2)}, 
                i: function(){return pad(jsdate.getMinutes(), 2)}, 
                s: function(){return pad(jsdate.getSeconds(), 2)}, 
                //u not supported yet 
   
                // Timezone 
                //e not supported yet 
                //I not supported yet 
                O: function(){ 
                    var t = pad(Math.abs(jsdate.getTimezoneOffset()/60*100), 4); 
                    if (jsdate.getTimezoneOffset() > 0) t = "-" + t; else t = "+" + t; 
                    return t; 
                }, 
                P: function(){var O = f.O();return (O.substr(0, 3) + ":" + O.substr(3, 2))}, 
                //T not supported yet 
                //Z not supported yet 
   
                // Full Date/Time 
                c: function(){return f.Y() + "-" + f.m() + "-" + f.d() + "T" + f.h() + ":" + f.i() + ":" + f.s() + f.P()}, 
                //r not supported yet 
                U: function(){return Math.round(jsdate.getTime()/1000)} 
            }; 
   
            return format.replace(/[\\]?([a-zA-Z])/g, function(t, s){ 
                if( t!=s ){ 
                    // escaped 
                    ret = s; 
                } else if( f[s] ){ 
                    // a date function exists 
                    ret = f[s](); 
                } else{ 
                    // nothing special 
                    ret = s; 
                } 
                return ret; 
            }); 
        }

        $(function () {
            'use strict';

            // 加载flag
            var loading = false;
            // 最多可加载的条目
            var maxItems ={pigcms:$count};
            // 每次加载添加多少条目
            var pagesize = 20;
            // 上次加载的序号
            var lastIndex =0;
            function addItems(pagesize, lastIndex) {
                var submitData = {
                    pagesize: pagesize,
                    lastIndex: lastIndex
                };
                $.post('/index.php?g=Wap&m=Store&a=getsignscoe', submitData,
                function (data) {
                    // 生成新条目的HTML
                    var html = '';
                    $.each(eval(data),function (index,item) {
                        var title = "";
                        switch (item.score_type) {
                            case "1":
                                title='<span style="color:blue">签到</span>';
                                break;
                            case "2":
                                title = '<span style="color:#f4c600">消费</span>';
                                break;
                            case "3":
                                title = '<span style="color:#56abe4">评价</span>';
                                break;
                            case "5":
                                title = '<span style="color:#ea8010">收益</span>';
                                break;
                                default:
                                    title = '<span style="color:#9d55b8">兑换</span>'
                        }
                        var expense = '+' + item.expense + '分';
                        if(this.score_type=="6")
                            expense = '-' + item.expense + '分';
                        html += '<li class="item-content"><div class="item-inner" ><div class="item-title" style="font-size:0.7rem">' + date('Y-m-d',item.sign_time) + '</div>';
                        html += '<div class="item-title" style="font-size:0.7rem;left:150px;position:absolute">'+title+'</div>';
                        html += '<div class="item-after" style="font-size:0.7rem">'+expense+'</div>';
                        html +'</div></li>';

                    });
                    // 添加新条目
                    $('.infinite-scroll-bottom .list-container').append(html);
                    lastIndex = $('.list-container li').length;
                    if (lastIndex >= maxItems) {
                        // 加载完毕，则注销无限加载事件，以防不必要的加载
                        $.detachInfiniteScroll($('.infinite-scroll'));
                        // 删除加载提示符
                        $('.infinite-scroll-preloader').remove();
                    }
                    $.hidePreloader();
                });
            }
            addItems(pagesize, 0);
            $(document).on('click', '.infinite-scroll-preloader', function () {
                $('.infinite-scroll-bottom').trigger("infinite");
                $.showPreloader();
            })
            // 注册'infinite'事件处理函数
            $(document).on('infinite','.infinite-scroll-bottom',function () {
                // 如果正在加载，则退出
                if (loading) return;
                // 设置flag
                loading = true;
                //模拟1s的加载过程
                setTimeout(function () {
                    // 重置加载flag
                    loading = false;
                    lastIndex = $('.list-container li').length;
                    if (lastIndex >= maxItems) {
                        // 加载完毕，则注销无限加载事件，以防不必要的加载
                        $.detachInfiniteScroll($('.infinite-scroll'));
                        // 删除加载提示符
                        $('.infinite-scroll-preloader').remove();
                        $.hidePreloader();
                        return;
                    }
                    addItems(pagesize, lastIndex);
                    // 添加新条目
                    // 更新最后加载的序号
                    //容器发生改变,如果是js滚动，需要刷新滚动
                    $.refreshScroller();
                }, 200);
            });
            $.init();
        });
    </script>
</body>
</html>