<!doctype html>
<html class="no-js fixed-layout">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>爱养车</title>
    <meta name="description" content="爱养车">
    <meta name="keywords" content="index">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <script src="/tpl/static/lib/jquery/jquery-1.9.0.min.js" type="text/javascript"></script>
    <script src="/tpl/static/lib/ligerUI/js/ligerui.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="http://cdn.amazeui.org/amazeui/2.7.0/css/amazeui.min.css" />
    <link rel="stylesheet" href="/tpl/static/assets/css/admin.css">
    <link href="/tpl/static/lib/ligerUI/skins/Aqua/css/ligerui-all.css" rel="stylesheet" type="text/css" />
</head>
<body>
    <!--[if lte IE 9]>
    <p class="browsehappy">你正在使用<strong>过时</strong>的浏览器，Amaze UI 暂不支持。 请 <a href="http://browsehappy.com/" target="_blank">升级浏览器</a>
      以获得更好的体验！</p>
    <![endif]-->
    <div class="am-cf admin-main" style="padding:0;margin:0">
        <!-- content start -->
        <div class="admin-content">
            <div class="admin-content-body">
                <div id="doc-qrcode" class="am-text-center"></div>
                <div class="am-cf am-padding am-padding-bottom-0">
                    <div class="am-fl am-cf"><strong class="am-text-primary am-text-lg">维修查询</strong> </div>
                </div>
                <hr>
                <div class="am-g">
                    <div class="am-u-sm-10 am-u-md-9">
                        <div class="am-form-group">
                            门店
                            <select data-am-selected="{btnSize: 'sm'}" id="shop">
                                <option value="">所有门店</option>
                                <option value="塘坑店">塘坑店</option>
                                <option value="区府店">区府店</option>
                            </select>
                            类别
                            <select data-am-selected="{btnSize: 'sm'}" id="lb">
                                <option value="">所有分类</option>
                                <option value="蜡水洗车">蜡水洗车</option>
                                <option value="蜡水洗车">汽车美容</option>
                                <option value="普通快修">普通快修</option>
                                <option value="常规保养">常规保养</option>
                                <option value="保险理赔">保险理赔</option>
                                <option value="汽车维修">汽车维修</option>
                            </select>
                            <div class="am-alert am-alert-danger" id="my-alert" style="display: none">
                                <p>开始日期应小于结束日期！</p>
                            </div>
                            <button type="button" class="am-btn am-btn-default am-margin-right" id="my-start">开始日期</button><span id="my-startDate"></span>
                            <button type="button" class="am-btn am-btn-default am-margin-right" id="my-end">结束日期</button><span id="my-endDate"></span>
                        </div>
                    </div>
                    <div class="am-u-sm-2 am-u-md-3">
                        <div class="am-input-group am-input-group-sm">
                            <input type="text" id="searchkey" class="am-form-field">
                            <span class="am-input-group-btn">
                                <button id="search" class="am-btn am-btn-default" type="button">模糊查询</button>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="am-g">
                    <div class="am-u-sm-12 am-u-md-12">
                        <button type="button" class="am-btn am-btn-primary" data-am-modal="{target: '#doc-modal-1', closeViaDimmer: 0,width:650}">洗车</button>
                        <button type="button" class="am-btn am-btn-primary" data-am-modal="{target: '#doc-modal-2', closeViaDimmer: 0,width:500}">美容</button>
                        <button type="button" class="am-btn am-btn-primary" data-am-modal="{target: '#doc-modal-3', closeViaDimmer: 0,width:500}">维修</button>
                    </div>
                </div>
                <div class="am-modal am-modal-no-btn" tabindex="-1" id="doc-modal-1">
                    <div class="am-modal-dialog">
                        <div class="am-modal-hd">
                            洗车录入
                            <a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>&times;</a>
                        </div>
                        <div class="am-modal-bd">
                            <div class="am-form">
                                <div class="am-g am-margin-top">
                                    <div class="am-u-sm-4 am-u-md-2 am-text-right">
                                        车牌号码
                                    </div>
                                    <div class="am-u-sm-8 am-u-md-4">
                                        <input type="text" name="carno" id="carno" class="am-input-sm">
                                    </div>
                                    <div class="am-hide-sm-only am-u-md-6">*必填</div>
                                </div>
                                <div class="am-g am-margin-top">
                                    <div class="am-u-sm-4 am-u-md-2 am-text-right">
                                        车主
                                    </div>
                                    <div class="am-u-sm-8 am-u-md-4 am-u-end col-end">
                                        <div id="chezhu"></div>
                                    </div>
                                </div>
                                <div class="am-g am-margin-top">
                                    <div class="am-u-sm-4 am-u-md-2 am-text-right">
                                        客户类别
                                    </div>
                                    <div class="am-u-sm-8 am-u-md-4 am-u-end col-end">
                                        <select data-am-selected name="group" id="group">
                                            <volist name="lblist" id="item">
                                                <option value="{pigcms:$item.客户类别}">{pigcms:$item.客户类别}</option>
                                            </volist>
                                            <option value="临时客户">临时客户</option>
                                        </select>
                                    </div>
                                </div>
                                <div id="qianyue" class="am-g am-margin-top" style="display:none">
                                    <div class="am-u-sm-4 am-u-md-2 am-text-right">
                                        定点金额
                                    </div>
                                    <div class="am-u-sm-8 am-u-md-4">
                                        <input type="text" name="money" id="money" value="25" class="am-input">
                                    </div>
                                    <div class="am-hide-sm-only am-u-md-6">元</div>
                                </div>
                                <div class="am-g am-margin-top">
                                    <div class="am-u-sm-4 am-u-md-2 am-text-right">
                                        美容师傅
                                    </div>
                                    <div class="am-u-sm-8 am-u-md-4 am-u-end col-end">
                                        <select data-am-selected name="person" id="person">
                                            <volist name="list" id="item">
                                                <option value="{pigcms:$item.姓名}">{pigcms:$item.姓名}</option>
                                            </volist>
                                        </select>
                                    </div>
                                </div>
                                <div class="am-g am-margin-top">
                                    <div class="am-u-sm-4 am-u-md-2 am-text-right">
                                        操作
                                    </div>
                                    <div class="am-u-sm-8 am-u-md-4 am-u-end col-end">
                                        <button class="am-btn am-btn-primary" id="reflash">
                                            <i class="am-icon-submit"></i>
                                            提交
                                        </button>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="am-modal am-modal-no-btn" tabindex="1" id="doc-modal-2">
                    <div class="am-modal-dialog">
                        <div class="am-modal-hd">
                            美容录入
                            <a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>&times;</a>
                        </div>
                        <div class="am-modal-bd">
                            <div class="am-form">
                                <div class="am-g am-margin-top">
                                    <div class="am-u-sm-4  am-text-right">
                                        车牌号码
                                    </div>
                                    <div class="am-u-sm-8 ">
                                        <input type="text" name="carno1" id="carno1" class="am-input-sm">
                                    </div>
                                </div>
                                <div class="am-g am-margin-top">
                                    <div class="am-u-sm-4  am-text-right">
                                        美容项目
                                    </div>
                                    <div class="am-u-sm-8  am-u-end col-end">
                                        <select data-am-selected name="project" id="project">
                                            <option value="">选择项目</option>
                                            <volist name="pjlist" id="item">
                                                <option value="{pigcms:$item.项目编号}">{pigcms:$item.项目名称}</option>
                                            </volist>
                                        </select>
                                    </div>
                                </div>
                                <div class="am-g am-margin-top">
                                    <div class="am-u-sm-4  am-text-right">
                                        接车人
                                    </div>
                                    <div class="am-u-sm-8  am-u-end col-end">
                                        <select data-am-selected name="fwgw" id="fwgw">
                                            <volist name="fwlist" id="item">
                                                <option value="{pigcms:$item.姓名}">{pigcms:$item.姓名}</option>
                                            </volist>
                                        </select>
                                    </div>
                                </div>
                                <div class="am-g am-margin-top">
                                    <div class="am-u-sm-4  am-text-right">
                                        美容师傅
                                    </div>
                                    <div class="am-u-sm-8  am-u-end col-end">
                                        <select data-am-selected name="mrperson" id="mrperson">
                                            <volist name="list" id="item">
                                                <option value="{pigcms:$item.姓名}">{pigcms:$item.姓名}</option>
                                            </volist>
                                        </select>
                                    </div>
                                </div>
                                <div class="am-g am-margin-top">
                                    <div class="am-u-sm-4 am-text-right">
                                        操作
                                    </div>
                                    <div class="am-u-sm-8  am-u-end col-end">
                                        <button class="am-btn am-btn-primary" id="mrsubmit">
                                            <i class="am-icon-submit"></i>
                                            提交
                                        </button>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="am-modal am-modal-no-btn" tabindex="2" id="doc-modal-3">
                    <div class="am-modal-dialog">
                        <div class="am-modal-hd">
                            维修录入
                            <a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>&times;</a>
                        </div>
                        <div class="am-modal-bd">
                            <div class="am-form">
                                <div class="am-g am-margin-top">
                                    <div class="am-u-sm-4  am-text-right">
                                        车牌号码
                                    </div>
                                    <div class="am-u-sm-8 ">
                                        <input type="text" name="carno2" id="carno2" class="am-input-sm">
                                    </div>
                                </div>
                                <div class="am-g am-margin-top">
                                    <div class="am-u-sm-4  am-text-right">
                                        维修类型
                                    </div>
                                    <div class="am-u-sm-8  am-u-end col-end">
                                        <select data-am-selected name="wxtype" id="wxtype">
                                            <option value="">选择维修类型</option>
                                            <option value="常规保养">常规保养</option>
                                            <option value="汽车维修">汽车维修</option>
                                            <option value="保险理赔">保险理赔</option>
                                            <option value="普通快修">普通快修</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="am-g am-margin-top">
                                    <div class="am-u-sm-4  am-text-right">
                                        接车人
                                    </div>
                                    <div class="am-u-sm-8  am-u-end col-end">
                                        <select data-am-selected name="fwgw1" id="fwgw1">
                                            <volist name="fwlist" id="item">
                                                <option value="{pigcms:$item.姓名}">{pigcms:$item.姓名}</option>
                                            </volist>
                                        </select>
                                    </div>
                                </div>
                                <div class="am-g am-margin-top">
                                    <div class="am-u-sm-4  am-text-right">
                                        维修师傅
                                    </div>
                                    <div class="am-u-sm-8  am-u-end col-end">
                                        <select data-am-selected name="wxperson" id="wxperson">
                                            <volist name="wxlist" id="item">
                                                <option value="{pigcms:$item.姓名}">{pigcms:$item.姓名}</option>
                                            </volist>
                                        </select>
                                    </div>
                                </div>
                                <div class="am-g am-margin-top">
                                    <div class="am-u-sm-4 am-text-right">
                                        操作
                                    </div>
                                    <div class="am-u-sm-8  am-u-end col-end">
                                        <button class="am-btn am-btn-primary" id="wxsubmit">
                                            <i class="am-icon-submit"></i>
                                            提交
                                        </button>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <div class="am-g">
                    <div class="am-u-sm-12">
                        <form class="am-form">
                            <table class="am-table am-table-striped am-table-hover table-main">
                                <thead>
                                    <tr>
                                        <th class="table-title">当前状态</th>
                                        <th class="table-title">制单日期</th>
                                        <th class="table-title">制单人</th>
                                        <th class="table-title">接车人</th>
                                        <th class="table-title">维修类别</th>
                                        <th class="table-title ">车主</th>
                                        <th class="table-title ">车牌号码</th>
                                        <th class="table-title ">客户类别</th>
                                        <th class="table-title ">联系人</th>
                                        <th class="table-title">轮胎规格</th>
                                        <th class="table-title">机油格</th>
                                        <th class="table-title ">空气格</th>
                                        <th class="table-title ">冷气格</th>
                                        <th class="table-title ">保险到期</th>
                                        <th class="table-title ">操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <volist name="yelist" id="item">
                                        <tr onclick="wxinfo('{pigcms:$item.序号}');;">
                                            <td>{pigcms:$item.当前状态}</td>
                                            <td>{pigcms:$item.制单日期|strtotime|date='Y-m-d',###}</td>
                                            <td>{pigcms:$item.制单人}</td>
                                            <td>{pigcms:$item.接车人}</td>
                                            <td>{pigcms:$item.维修类别}</td>
                                            <td>{pigcms:$item.车主}</td>
                                            <td><a href="javascript:void(0);" onclick="carinfo('{pigcms:$item.车牌号码}');"><strong>{pigcms:$item.车牌号码}</strong></a></td>                                            <td>{pigcms:$item.客户类别}</td>
                                            <td>{pigcms:$item.送修人}</td>
                                            <td>{pigcms:$item.轮胎规格}</td>
                                            <td>{pigcms:$item.机油格}</td>
                                            <td>{pigcms:$item.空气格}</td>
                                            <td>{pigcms:$item.冷气格}</td>
                                            <td>{pigcms:$item.交保到期|strtotime|date='Y-m-d',###}</td>
                                            <td>
                                                <if condition="$item['制单人'] eq '系统录单' and $item['当前主修人'] eq ''">
                                                    <a href="javascript:void(0);" onclick="assigntask('{pigcms:$item.序号}');"><strong>派工</strong></a>
                                                </if>
                                            </td>
                                        </tr>

                                    </volist>
                                </tbody>
                            </table>
                            <div class="am-cf">
                                <div class="am-fr">
                                    <div class="cLine">
                                        <div class="pageNavigator right">
                                            <div class="pages">{pigcms:$page}</div>
                                        </div>
                                        <div class="clr"></div>
                                    </div>
                                </div>
                            </div>
                            <hr />
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!-- content end -->
    </div>
    <div id="maingrid4" style="margin:0; padding:0"></div>
    <a href="#" class="am-icon-btn am-icon-th-list am-show-sm-only admin-menu" data-am-offcanvas="{target: '#admin-offcanvas'}"></a>
    <script src="http://cdn.amazeui.org/amazeui/2.7.0/js/amazeui.min.js"></script>
    <script src="/tpl/static/assets/js/app.js"></script>
    <script>
        function wxinfo(xh) {
            stopBubble(event);
            $.ligerDialog.open({
                height: 500,
                url: '/index.php?g=Query&m=Consume&a=wxinfo&xh=' + xh,
                width: 900,
                showMax: true,
                showToggle: true,
                showMin: true,
                isResize: true,
                modal: false,
                title: '车辆维修详细信息'
            });
        }

        function carinfo(carno) {
            stopBubble(event);
            $.ligerDialog.open({
                height: 500,
                url: '/index.php?g=Query&m=Consume&a=carinfo&carno=' + carno,
                width: 900,
                showMax: true,
                showToggle: true,
                showMin: true,
                isResize: true,
                modal: false,
                title: '车辆信息编辑'
            });
        }
        function stopBubble(e) {
            //如果提供了事件对象，则这是一个非IE浏览器 
            if (e && e.stopPropagation)
                //因此它支持W3C的stopPropagation()方法 
                e.stopPropagation();
            else
                //否则，我们需要使用IE的方式来取消事件冒泡 
                window.event.cancelBubble = true;
        }
        //阻止浏览器的默认行为 
        function stopDefault(e) {
            //阻止默认浏览器动作(W3C) 
            if (e && e.preventDefault)
                e.preventDefault();
                //IE中阻止函数器默认动作的方式 
            else
                window.event.returnValue = false;
            return false;
        }
        function assigntask(itemid) {
            stopBubble(event);
            $('#doc-modal-3').modal({
                relatedTarget: this,
                width: 380,
                closeOnConfirm: false,
                onConfirm: function (e) {
                    var zhuxiu = $('#zhuxiu').val();
                    var data = {
                        zhuxiu: zhuxiu,
                        itemid: itemid,
                    };
                    $.post('/index.php?g=Query&m=Consume&a=wxcx', data,
                      function (msg) {
                          alert(msg);
                          $('#doc-modal-3').modal('close');
                          location.href = location.href;
                      });
                },
                onCancel: function (e) {
                }
            });
        }
        var grid = null;
        $(function () {
            grid = $("#maingrid4").ligerGrid({
                columns: [
                { display: '主键', name: 'CustomerID', align: 'left', width: 120 },
                { display: '公司名', name: 'CompanyName', minWidth: 60 },
                { display: '联系名', name: 'ContactName', width: 50, align: 'left' },
                { display: '联系名', name: 'ContactName', minWidth: 140 },
                { display: '联系名', name: 'ContactName', minWidth: 140 },
                { display: '联系名', name: 'ContactName', minWidth: 140 },
                { display: '联系名', name: 'ContactName', minWidth: 140 },
                { display: '城市', name: 'City' }
                ],
                pageSize: 10,
                where: f_getWhere(),
                data: $.extend(true, {}, CustomersData),
                width: '100%', height: '100%'
            });


            $("#pageloading").hide();
        });
        function f_search() {
            grid.options.data = $.extend(true, {}, CustomersData);
            grid.loadData(f_getWhere());
        }
        function f_getWhere() {
            if (!grid) return null;
            var clause = function (rowdata, rowindex) {
                var key = $("#txtKey").val();
                return rowdata.CustomerID.indexOf(key) > -1;
            };
            return clause;
        }
        $(document).ready(function () {

            $('#carno').blur(function () {
                var submitData = {
                    carno: $('#carno').val()
                };
                $.post('index.php?g=Query&m=Consume&a=getgrade', submitData,
                 function (data) {
                     if (data) {
                         $('#chezhu').text(data.车主);
                         $('#group').val(data.客户类别);
                         var select = '#group option[value="' + data.客户类别 + '"]';
                         var $o = $(select)[0].index;
                         $('#group').find('option').eq($o).attr('selected', true);
                         //$("#group option[@value='" + data.客户类别 + "']").attr("selected", "true");
                     }
                     else {
                         $('#chezhu').text('0000');
                         $('#group').find('option:last').attr('selected', true);
                     }
                 }, 'JSON');
            });
            $("#group").change(function () {
                if ($("#group").val() == '定点签约') {
                    $('#qianyue').show();
                }
                else {
                    $('#qianyue').hide();
                    $('#momey').val("");
                }
            });
            $('#reflash').click(function () {
                if ($('#carno').val() == '') {
                    alert('请输入车牌号码');
                    return;
                }
                var submitData = {
                    carno: $('#carno').val(),
                    person: $('#person').val(),
                    money: $('#money').val()
                };
                $.post('index.php?g=Query&m=Consume&a=record', submitData,
                  function (data) {
                      alert(data);
                      location.href = location.href;
                  });
            });
            $('#mrsubmit').click(function () {
                if ($('#carno1').val() == '') {
                    alert('请输入车牌号码');
                    return;
                }
                if ($('#project').val() == '')
                {
                    alert('请选择美容项目');
                    return;
                }
                var submitData = {
                    carno: $('#carno1').val(),
                    person: $('#mrperson').val(),
                    fwgw: $('#fwgw').val(),
                    project: $('#project').val()
                };
                $.post('index.php?g=Query&m=Consume&a=mrrecord', submitData,
                  function (data) {
                      alert(data);
                      location.href = location.href;
                  });
            });
            $('#wxsubmit').click(function () {
                if ($('#carno2').val() == '') {
                    alert('请输入车牌号码');
                    return;
                }
                if ($('#wxtype').val()=='') {
                    alert('请选择维修类型');
                    return;
                }
                var submitData = {
                    carno: $('#carno2').val(),
                    person: $('#wxperson').val(),
                    fwgw: $('#fwgw1').val(),
                    wxtype: $('#wxtype').val()
                };
                $.post('index.php?g=Query&m=Consume&a=wxrecord', submitData,
                  function (data) {
                      alert(data);
                      location.href = location.href;
                  });
            });

            var startDate = new Date(2014, 11, 20);
            var endDate = new Date(2014, 11, 25);
            var $alert = $('#my-alert');
            $('#my-start').datepicker();
            $('#my-end').datepicker();
            $('#search').click(function () {
                var url = '/index.php?g=Query&m=Consume&a=wxcx';
                var endDate = $('#my-endDate').text();
                if (endDate != '')
                    url += '&endDate=' + endDate;
                var startDate = $('#my-startDate').text();
                if (startDate != '')
                    url += '&startDate=' + startDate;
                var shop = $('#shop').val();
                if (shop != '')
                    url += '&shop=' + lb;
                var lb = $('#lb').val();
                if (lb != '')
                    url += '&lb=' + lb;
                var searchkey = $('#searchkey').val();
                if (searchkey != '')
                    url += '&searchkey=' + searchkey;
                location.href = url;
            });

        });
        //reflash();
        //function reflash() {

        //    location.href = location.href;
        //    setTimeout("reflash()", 100000);

        //}
    </script>

</body>
</html>
